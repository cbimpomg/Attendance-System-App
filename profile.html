<html>
<head>
  <title>Profile Page</title>
<style>
  body {
  overflow-x: hidden;
  padding:0px;
  margin:0px
}
.my_div{
  position:relative;
  width:45%;
  height:fit-content;
  line-height: 1;
  display:flex;
  float: left;
  flex-direction: column;
  padding:1px;
  padding-left:10px;
  margin: 5px;
  box-shadow: 0 0 15px 0px rgba(31, 148, 15, 0.5);
}
card_1{
  justify-content: center;
  align-items: center;
}

</style>
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
let empname = document.getElementById('name');
let username = document.getElementById('username');
let address = document.getElementById('address');
let email = document.getElementById('email');
let age = document.getElementById('age');
let username2 = document.getElementById('username2');

let attendancetime = document.getElementById('attime');
let attendancetimes = document.getElementById('attimes');
let latimes = document.getElementById('lates');
let latime = document.getElementById('late');
let abscetime = document.getElementById('absc');
let abscetimes = document.getElementById('abscs');
let excuse = document.getElementById('excuse');
let excuses = document.getElementById('excuses');
let seruser = '';

let logout = document.getElementById('logout');
logout.addEventListener('click', function () {
  // clear session storage
  sessionStorage.clear();
  window.location.href = '../index.html';
});


let jsarray2 = JSON.parse(sessionStorage.getItem('jsArray2'));
console.log(jsarray2);




let arr2 = [];
let emptype = '';

let xhr = new XMLHttpRequest();
xhr.open('get', `http://localhost:3000/users`);
xhr.onload = function () {
  let arr = JSON.parse(xhr.responseText);
  for (let i = 0; i < arr.length; i++) {
    if (arr[i].username == jsarray2[0]) {
      switch (arr[i].flag) {
        case 0:
          emptype = 'Employee';
          break;
        case 1:
          emptype = 'Sub Admin';
          break;
        case 2:
          emptype = 'Admin';
          break;
      }

      const time = '8';
      let timeend = new Date(`${jsarray2[2]}:2023`).getHours();
      console.log(timeend);

      let latee = 'no';
      let excusess = 'no';
      let absencettt = 'no';
      
      if (timeend - time == 1) {
        latee = 'yes';
      }
      if (timeend - time > 1) {
        latee = 'no';
        excusess = 'no';
        absencettt = 'yes';
      }
      
      $.getJSON(
        `http://localhost:3000/reports/?userid=${arr[i].id}`,
        function (json) {
          arr2 = json;
          let attendanctime = 0;
          let latetime = 0;
          let absencetime = 0;
          let excusetims = 0;

          //get the first element of the array
          for (let g = 0; g < arr2.length; g++) {
            if (arr[i].id == arr2[g].userid) {
              
              console.log(arr2[g].absencetim);


              attendanctime = attendanctime + arr2[g].attendance;
              latetime = latetime + arr2[g].late;
              absencetime = absencetime + arr2[g].absencetim;
              excusetims = excusetims + arr2[g].excuse;

              
            }
          }

          let fullname =
            arr[i].fname.charAt(0).toUpperCase() +
            arr[i].fname.slice(1) +
            ' ' +
            arr[i].lname.charAt(0).toUpperCase() +
            arr[i].lname.slice(1);
          empname.innerText = fullname;
          username.innerText = jsarray2[0];
          address.innerText = arr[i].address;
          email.innerText = arr[i].email;
          age.innerText = arr[i].age;
          attendancetime.value = jsarray2[2];
          username2.innerText = arr[i].username;
          catig.innerText = emptype;
          attendancetimes.value = attendanctime;
          latimes.value = latetime;
          latime.value = latee;
          abscetime.value = absencettt;
          abscetimes.value = absencetime;
          excuse.value = excusess;
          excuses.value = excusetims;
        }
      );
    }
  }
};
xhr.send(); -->

</script>

</head>

<body>
  <nav class="navbar navbar-expand-md bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="home.html">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link fw-bold" href="home.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link  fw-bold" aria-current="page" href="attendance.html">Take Attendance</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active fw-bold" href="profile.html">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link fw-bold" href="report.html">Reports</a>
          </li>
          <li class="nav-item">
            <a class="nav-link  fw-bold" href="adminpanel.html">Admin Panel</a>
          </li>
          <li class="nav-item">
            <a class="btn btn-danger btn-outline-danger text-white" id="logout">
              Log Out
              <i class="bi bi-door-open"></i>
            </a>
          </li>
        </ul>

      </div>
    </div>
  </nav>


  
  <section class="container">
    <div class="row">
        <div class="my_div card_1">
                <h2 id="name">Welcome to your profile page</h2>
                <p id="username_">username</p>
        </div>
        
        <div class="my_div card_2">
                <h6>username</h6>
                <span id="username_2">
                </span>

                <h6>Email</h6>
                <span id="email">
                </span>

                <h6>Address</h6>
                <span id="address">
                </span>

                <h6>Age</h6>
                <span id="age">
                </span>
        </div>

        <div class="my_div card_3">
            <h5>Last Login Time:</h5>
            <span class="last_login_time">
            </span>

            <h5>Attended at:</h5>
            <span class="attended">
            </span>

            <h5>leaving at:</h5>
            <span class="leaving">15:30</span>

            <h5>status:</h5>
            <span class="status">
            </span>
      </div>


          <div class="my_div card_4">
            <h4>
              Monthly Report
            </h4>
            <h5>Attendance Times:</h5><span class="att_times"></span>
            
            <h5>Late Times:</h5><span class="late_times"></span>

            <h5>Absent Times:</h5><span class="atbs_times"></span>
          </div>
      </div>
</section>
</body>

</html>